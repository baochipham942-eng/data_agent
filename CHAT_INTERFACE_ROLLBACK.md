# 会话界面回退说明

## 回退原因

用户反馈会话界面被改得太复杂，导致问题频出。已回退到简化版本。

## 回退内容

### 1. useChat Hook 简化
- **备份文件**: `frontend/src/hooks/useChat.complex.backup.ts`（原复杂版本）
- **当前文件**: `frontend/src/hooks/useChat.ts`（简化版）

### 简化版本特点

#### 移除的复杂功能
- ❌ 复杂的推理步骤（6步思维链）
- ❌ 意图分析 API 调用
- ❌ 复杂的 SQL 提取逻辑
- ❌ 表格数据提取和处理
- ❌ 图表数据提取
- ❌ 复杂的步骤状态管理

#### 保留的核心功能
- ✅ 发送消息
- ✅ 接收 SSE 流
- ✅ 流式文本显示
- ✅ 简单的 SQL 提取（从文本）
- ✅ 会话 ID 管理
- ✅ 加载历史会话
- ✅ 错误处理

### 2. 代码简化对比

**之前（复杂版）**：
- 约 800 行代码
- 6 步推理流程
- 多个状态管理
- 复杂的 SSE 数据解析

**现在（简化版）**：
- 约 150 行代码
- 只处理文本和 SQL
- 简单的状态管理
- 基础的 SSE 处理

## 如何使用

简化版已经替换了复杂版。如果需要恢复复杂版本：

```bash
cd frontend/src/hooks
mv useChat.ts useChat.simple.ts
mv useChat.complex.backup.ts useChat.ts
```

## 后续建议

1. **先确保简化版稳定运行**
2. **再逐步添加功能**（如果需要）
3. **每次只添加一个功能并充分测试**

## 测试清单

- [ ] 发送消息能正常工作
- [ ] SSE 流能正常接收和显示
- [ ] SQL 能正确提取和显示
- [ ] 历史会话能正常加载
- [ ] 错误处理正常








