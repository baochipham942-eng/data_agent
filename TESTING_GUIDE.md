# 功能测试指南

## 📋 测试范围

本次测试包含两个主要优化：
1. **会话详情页展示一致性** - 确保与聊天页面显示相同的信息
2. **多轮对话优化** - 快捷操作按钮和智能追问识别

## 🧪 测试步骤

### 测试1：会话详情页展示一致性

#### 步骤1：发送一个查询问题
```
用户输入: "最近7天按日期统计访问量的变化趋势"
```

**预期结果**：
- ✅ 显示完整的6步推理过程
  - 步骤1：理解问题（包含语义分词）
  - 步骤2：选择数据表
  - 步骤3：参考业务知识
  - 步骤4：生成SQL查询
  - 步骤5：执行查询获取数据
  - 步骤6：生成分析结果
- ✅ 显示SQL代码块
- ✅ 显示数据表格
- ✅ 显示图表（默认折线图）
- ✅ 显示消息操作按钮（点赞、点踩、复制、联系专家）

#### 步骤2：查看会话历史评测
1. 点击左侧菜单"会话历史评测"
2. 在列表中找到一个会话记录
3. 点击"详情"按钮

**预期结果**：
- ✅ 会话详情页面显示与聊天页面**完全相同**的内容：
  - 6步推理过程（不是4步）
  - 语义分词展示（如果有）
  - 表选择信息（如果有）
  - SQL代码块
  - 数据表格
  - 图表
  - 消息操作按钮
  - 调试信息（RAG、Memory使用情况）

### 测试2：快捷操作按钮

#### 步骤1：发送第一个查询
```
用户输入: "最近7天的销量趋势如何？"
```

**预期结果**：
- ✅ 显示查询结果
- ✅ 在助手消息的操作按钮下方，显示**快捷操作**区域：
  - 🔄 环比分析
  - 📈 同比分析
  - 📊 对比分析
  - 📦 按维度拆分

**注意**：快捷操作按钮只在**最新的助手消息**且有查询结果时显示。

#### 步骤2：点击快捷操作
点击"环比分析"按钮

**预期结果**：
- ✅ 自动发送消息："帮我做个环比分析"
- ✅ 系统识别为追问意图（followup）
- ✅ 问题被改写为包含上下文："基于「最近7天的销量趋势如何？」的结果，计算环比增长率"
- ✅ 系统基于上次查询结果进行分析

#### 步骤3：测试其他快捷操作
依次测试：
- "同比分析" → 发送"帮我做个同比分析"
- "对比分析" → 发送"对比一下不同时间段的数据"
- "按维度拆分" → 发送"按维度拆分一下数据"

### 测试3：手动追问识别

#### 步骤1：发送第一个查询
```
用户输入: "这个月的销售额是多少？"
```

#### 步骤2：手动输入追问
```
用户输入: "帮我做个环比分析"
```

**预期结果**：
- ✅ 系统识别为 `followup` 意图
- ✅ 问题被改写为包含上下文
- ✅ 保留上次查询的表和SQL信息

### 测试4：边界情况测试

#### 测试4.1：快捷操作不显示的情况
1. 发送一个无法回答的问题（如"查询不存在的数据"）
2. **预期**：不显示快捷操作按钮（因为没有查询结果）

#### 测试4.2：不是最新消息的情况
1. 发送第一个查询
2. 发送第二个查询
3. 查看第一个查询的结果
4. **预期**：第一个查询结果不显示快捷操作（因为不是最新消息）

#### 测试4.3：加载中状态
1. 点击快捷操作按钮
2. **预期**：按钮在加载期间被禁用

## 🔍 验证点

### 前端验证
- [ ] 快捷操作按钮显示正确
- [ ] 点击按钮能正确发送消息
- [ ] 会话详情页显示6步推理（不是4步）
- [ ] 会话详情页有MessageActions组件
- [ ] 语义分词在详情页正确显示

### 后端验证
- [ ] 意图识别能识别"环比"、"同比"等关键词
- [ ] 追问意图的置信度 ≥ 0.9
- [ ] 问题改写包含上下文信息
- [ ] extra_json中包含query_analysis信息

### 数据流验证
- [ ] 快捷操作发送的消息被正确识别为追问
- [ ] 上下文信息正确传递
- [ ] 调试信息（RAG/Memory）正确记录和展示

## 📝 测试检查清单

### 会话详情页一致性
- [ ] ✅ 显示6步推理格式（不是4步）
- [ ] ✅ 包含语义分词可视化
- [ ] ✅ 包含表选择信息
- [ ] ✅ 包含业务知识引用
- [ ] ✅ 显示MessageActions组件
- [ ] ✅ 显示调试信息（如果有）

### 快捷操作功能
- [ ] ✅ 按钮正确显示（有查询结果时）
- [ ] ✅ 按钮不显示（无查询结果时）
- [ ] ✅ 按钮不显示（不是最新消息时）
- [ ] ✅ 点击按钮发送正确的消息
- [ ] ✅ 系统识别为追问意图
- [ ] ✅ 问题被正确改写

### 追问识别
- [ ] ✅ "环比分析" → followup
- [ ] ✅ "同比分析" → followup
- [ ] ✅ "对比分析" → followup
- [ ] ✅ "按维度拆分" → followup
- [ ] ✅ 手动输入快捷操作关键词 → followup

## 🐛 已知问题

暂无已知问题。如发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 预期结果 vs 实际结果
4. 相关截图（如有）

## 📞 问题反馈

如发现bug或需要改进，请：
1. 记录问题详情
2. 查看浏览器控制台错误
3. 检查后端日志
4. 联系开发团队

## 🎉 测试完成后

如果所有测试通过，说明：
- ✅ 会话详情页展示一致性已修复
- ✅ 多轮对话快捷操作功能正常
- ✅ 追问识别和改写工作正常
- ✅ 系统可以投入使用了！









