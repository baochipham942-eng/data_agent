# RAG å®ç°çŠ¶æ€

## âœ… å·²å®Œæˆ

### é˜¶æ®µ1ï¼šåˆ›å»º RAG çŸ¥è¯†åº“åŸºç¡€ç»“æ„ âœ…
- âœ… åˆ›å»ºäº† `app/services/rag_knowledge_base.py`
- âœ… æ•°æ®åº“è¡¨ç»“æ„ï¼ˆ`rag_qa_pairs`ï¼‰
- âœ… åŸºç¡€çš„ CRUD æ“ä½œ
- âœ… åŸºäºå…³é”®è¯çš„æ£€ç´¢ï¼ˆJaccard ç›¸ä¼¼åº¦ï¼‰
- âœ… å»é‡æ£€æŸ¥æœºåˆ¶
- âœ… è¯„åˆ†æ›´æ–°æœºåˆ¶

### é˜¶æ®µ1åç»­ï¼šRAGLearner æœåŠ¡ âœ…
- âœ… åˆ›å»ºäº† `app/services/rag_learner.py`
- âœ… ä»é«˜åˆ†åé¦ˆä¸­æå–é—®ç­”å¯¹
- âœ… è´¨é‡è¯„ä¼°ï¼ˆé—®é¢˜æ¸…æ™°åº¦ã€SQLæœ‰æ•ˆæ€§ã€ç­”æ¡ˆç›¸å…³æ€§ï¼‰
- âœ… å»é‡æ£€æŸ¥å¹¶æ›´æ–°è¯„åˆ†
- âœ… è‡ªåŠ¨æå–æ ‡ç­¾å’Œåˆ†ç±»
- âœ… é›†æˆåˆ°åé¦ˆå­¦ä¹ æµç¨‹ï¼ˆ`FeedbackLearner`ï¼‰

### é˜¶æ®µ2ï¼šå‘é‡åŒ–æ£€ç´¢ ğŸ”„
- âœ… åˆ›å»ºäº† `app/services/embedding_service.py`
- âœ… æ”¯æŒæœ¬åœ°æ¨¡å‹ï¼ˆsentence-transformersï¼‰
- âœ… æ”¯æŒ OpenAI embeddingsï¼ˆå¯é€‰ï¼‰
- âœ… é™çº§æ–¹æ¡ˆï¼ˆç®€å•è¯é¢‘å‘é‡ï¼‰
- âœ… å‘é‡åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆpickleï¼‰
- âœ… RAG çŸ¥è¯†åº“æ”¯æŒå‘é‡å­˜å‚¨å’Œæ£€ç´¢
- ğŸ”„ **å¾…å®Œæˆ**ï¼šåœ¨ RAGLearner ä¸­è‡ªåŠ¨ç”Ÿæˆå‘é‡åµŒå…¥

### é˜¶æ®µ3ï¼šè‡ªåŠ¨å­¦ä¹ ä¼˜åŒ– âœ…
- âœ… è´¨é‡è¯„ä¼°æœºåˆ¶
- âœ… å»é‡å’Œç›¸ä¼¼åº¦æ£€æŸ¥
- âœ… è‡ªåŠ¨æ›´æ–°è¯„åˆ†
- âœ… æ ‡ç­¾å’Œåˆ†ç±»è‡ªåŠ¨æå–

### é˜¶æ®µ4ï¼šé›†æˆåˆ° SQL ç”Ÿæˆæµç¨‹ âœ…
- âœ… ä¿®æ”¹äº† `FewShotSelector`ï¼Œä¼˜å…ˆä» RAG çŸ¥è¯†åº“æ£€ç´¢
- âœ… é™çº§åˆ° Agent Memoryï¼ˆå¦‚æœ RAG çŸ¥è¯†åº“ç¤ºä¾‹ä¸è¶³ï¼‰
- âœ… é›†æˆåˆ° `init_sql_enhancer`
- âœ… åœ¨ `main.py` ä¸­ä¼ å…¥ RAG çŸ¥è¯†åº“
- âœ… ä½¿ç”¨è®¡æ•°å’Œæœ€åä½¿ç”¨æ—¶é—´è·Ÿè¸ª

## ğŸ“ é›†æˆçŠ¶æ€

### å·²é›†æˆçš„ä½ç½®
1. âœ… `main.py`: RAG çŸ¥è¯†åº“åˆå§‹åŒ–
2. âœ… `app/routes/feedback.py`: RAGLearner é›†æˆåˆ°åé¦ˆå­¦ä¹ 
3. âœ… `app/services/sql_enhancer.py`: FewShotSelector ä¼˜å…ˆä½¿ç”¨ RAG
4. âœ… `app/services/llm_judge.py`: FeedbackLearner è°ƒç”¨ RAGLearner

### æ•°æ®æµ
```
ç”¨æˆ·åé¦ˆ/è¯„æµ‹
    â†“
è¯„åˆ† >= 4.0?
    â†“ æ˜¯
FeedbackLearner.learn_from_feedback()
    â†“
RAGLearner.learn_from_feedback()
    â†“
è´¨é‡è¯„ä¼° + å»é‡æ£€æŸ¥
    â†“
å­˜å‚¨åˆ° RAG çŸ¥è¯†åº“
    â†“
---
ç”¨æˆ·é—®é¢˜
    â†“
FewShotSelector.select_examples()
    â†“
ä¼˜å…ˆä» RAG çŸ¥è¯†åº“æ£€ç´¢ï¼ˆé«˜è´¨é‡ç¤ºä¾‹ï¼‰
    â†“
å¦‚æœä¸è¶³ï¼Œä» Agent Memory è¡¥å……
    â†“
æ ¼å¼åŒ– Few-shot ç¤ºä¾‹
    â†“
æ³¨å…¥ SQL ç”Ÿæˆ Prompt
```

## ğŸ”„ å¾…å®Œå–„

### å¯é€‰å¢å¼º
1. **å‘é‡åµŒå…¥è‡ªåŠ¨ç”Ÿæˆ**ï¼š
   - åœ¨ RAGLearner ä¸­é›†æˆ EmbeddingService
   - å­˜å‚¨æ—¶è‡ªåŠ¨ç”Ÿæˆå‘é‡åµŒå…¥
   - éœ€è¦æ—¶å¯ä»¥å®‰è£…ï¼š`pip install sentence-transformers`

2. **æ··åˆæ£€ç´¢ä¼˜åŒ–**ï¼š
   - åŒæ—¶ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦ + å…³é”®è¯åŒ¹é…
   - åŠ æƒç»¼åˆè¯„åˆ†

3. **RAG çŸ¥è¯†åº“ç®¡ç†ç•Œé¢**ï¼š
   - æŸ¥çœ‹æ‰€æœ‰ RAG æ¡ç›®
   - æ‰‹åŠ¨æ·»åŠ /åˆ é™¤æ¡ç›®
   - æ‰¹é‡å¯¼å…¥å¯¼å‡º

4. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å‘é‡ç´¢å¼•ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰
   - ç¼“å­˜çƒ­é—¨æ£€ç´¢ç»“æœ

## ğŸ§ª æµ‹è¯•å»ºè®®

1. **æµ‹è¯•é«˜åˆ†æ¡ˆä¾‹è‡ªåŠ¨å­¦ä¹ **ï¼š
   - æäº¤ä¸€ä¸ªä¸“å®¶è¯„åˆ† >= 4.0 çš„ä¼šè¯
   - æ£€æŸ¥ RAG çŸ¥è¯†åº“æ˜¯å¦æ·»åŠ äº†è¯¥æ¡ç›®
   - æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰ "RAG å­¦ä¹ æˆåŠŸ" æ¶ˆæ¯

2. **æµ‹è¯• Few-shot æ£€ç´¢**ï¼š
   - å‘é€ä¸€ä¸ªä¸é«˜åˆ†æ¡ˆä¾‹ç›¸ä¼¼çš„é—®é¢˜
   - æ£€æŸ¥è¿”å›çš„ç¤ºä¾‹æ˜¯å¦åŒ…å« RAG çŸ¥è¯†åº“ä¸­çš„æ¡ç›®
   - éªŒè¯ç¤ºä¾‹è´¨é‡

3. **æµ‹è¯•å»é‡æœºåˆ¶**ï¼š
   - æäº¤ä¸¤ä¸ªç›¸åŒæˆ–é«˜åº¦ç›¸ä¼¼çš„ä¼šè¯
   - æ£€æŸ¥ç¬¬äºŒä¸ªæ˜¯å¦æ›´æ–°äº†è¯„åˆ†è€Œä¸æ˜¯åˆ›å»ºæ–°æ¡ç›®

## ğŸ“Š å½“å‰ç»Ÿè®¡

å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æŸ¥çœ‹ RAG çŸ¥è¯†åº“ç»Ÿè®¡ï¼š

```python
from app.services.rag_knowledge_base import RAGKnowledgeBase
from app.config import SYSTEM_DB_PATH

kb = RAGKnowledgeBase(SYSTEM_DB_PATH)
stats = kb.get_stats()
print(stats)
```

## ğŸš€ ä½¿ç”¨è¯´æ˜

### 1. è‡ªåŠ¨å­¦ä¹ ï¼ˆå·²å¯ç”¨ï¼‰
- å½“ç”¨æˆ·æäº¤ä¸“å®¶è¯„åˆ† >= 4.0 æ—¶ï¼Œè‡ªåŠ¨å­¦ä¹ åˆ° RAG çŸ¥è¯†åº“
- å½“ LLM è¯„ä¼°è¯„åˆ† >= 4.0 æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨å­¦ä¹ 

### 2. Few-shot æ£€ç´¢ï¼ˆå·²å¯ç”¨ï¼‰
- `FewShotSelector` ä¼šè‡ªåŠ¨ä¼˜å…ˆä» RAG çŸ¥è¯†åº“æ£€ç´¢
- å¦‚æœ RAG çŸ¥è¯†åº“æ²¡æœ‰è¶³å¤Ÿç¤ºä¾‹ï¼Œä¼šä» Agent Memory è¡¥å……

### 3. å‘é‡åµŒå…¥ï¼ˆå¯é€‰ï¼‰
- å¦‚éœ€å¯ç”¨å‘é‡æ£€ç´¢ï¼Œéœ€è¦ï¼š
  1. å®‰è£…ï¼š`pip install sentence-transformers`
  2. åœ¨åˆå§‹åŒ–æ—¶ä¼ å…¥ EmbeddingServiceï¼š
     ```python
     from app.services.embedding_service import EmbeddingService
     from app.services.rag_knowledge_base import RAGKnowledgeBase
     
     embedding_service = EmbeddingService()
     rag_kb = RAGKnowledgeBase(embedding_service=embedding_service)
     ```
  3. æ£€ç´¢æ—¶ä½¿ç”¨ï¼š`rag_kb.retrieve_similar(..., use_vector=True)`

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `app/services/rag_knowledge_base.py` - RAG çŸ¥è¯†åº“æ ¸å¿ƒ
- `app/services/rag_learner.py` - RAG è‡ªåŠ¨å­¦ä¹ å™¨
- `app/services/embedding_service.py` - å‘é‡åµŒå…¥æœåŠ¡
- `app/services/sql_enhancer.py` - SQL å¢å¼ºï¼ˆFewShotSelectorï¼‰
- `app/routes/feedback.py` - åé¦ˆè·¯ç”±ï¼ˆé›†æˆ RAG å­¦ä¹ ï¼‰
- `app/services/llm_judge.py` - åé¦ˆå­¦ä¹ å™¨ï¼ˆé›†æˆ RAGï¼‰

## âœ… æ€»ç»“

**é˜¶æ®µ1-4 çš„æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼**

ç³»ç»Ÿç°åœ¨æ”¯æŒï¼š
- âœ… ä»é«˜åˆ†åé¦ˆä¸­è‡ªåŠ¨å­¦ä¹ é—®ç­”å¯¹
- âœ… é«˜è´¨é‡ç¤ºä¾‹çš„å­˜å‚¨å’Œç®¡ç†
- âœ… ä¼˜å…ˆä» RAG çŸ¥è¯†åº“æ£€ç´¢ Few-shot ç¤ºä¾‹
- âœ… è´¨é‡è¯„ä¼°å’Œå»é‡æœºåˆ¶
- âœ… å‘é‡æ£€ç´¢æ”¯æŒï¼ˆå¯é€‰ï¼‰

ä¸‹ä¸€æ­¥å¯ä»¥ï¼š
- æµ‹è¯•å®Œæ•´æµç¨‹
- æ ¹æ®éœ€è¦å¯ç”¨å‘é‡åµŒå…¥
- æ·»åŠ ç®¡ç†ç•Œé¢ï¼ˆå¯é€‰ï¼‰









